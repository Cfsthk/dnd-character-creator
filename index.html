<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D&D 5E ÂÆåÊï¥Ë≥áÊñôÂ∫´ - ÁπÅÈ´î‰∏≠Êñá</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', 'ÂæÆËªüÊ≠£ÈªëÈ´î', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            background: #f5f5f5;
            border-bottom: 3px solid #ddd;
        }

        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            font-size: 1.2em;
            font-weight: bold;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }

        .tab:hover {
            background: #e0e0e0;
        }

        .tab.active {
            background: white;
            border-bottom: 3px solid #667eea;
            color: #667eea;
        }

        .content {
            padding: 30px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .card {
            background: #f9f9f9;
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            border-color: #667eea;
        }

        .card h3 {
            color: #1e3c72;
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .card .subtitle {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        .card .description {
            color: #444;
            font-size: 0.95em;
            line-height: 1.5;
            margin-top: 10px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            overflow-y: auto;
            padding: 20px;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px 15px 0 0;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .modal-header h2 {
            font-size: 2em;
            margin-bottom: 5px;
        }

        .modal-header .subtitle {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .close-btn {
            position: absolute;
            top: 20px;
            right: 25px;
            font-size: 2em;
            cursor: pointer;
            color: white;
            background: rgba(255,255,255,0.2);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .close-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 30px;
        }

        .section {
            margin-bottom: 25px;
        }

        .section h3 {
            color: #1e3c72;
            font-size: 1.5em;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .section h4 {
            color: #2a5298;
            font-size: 1.2em;
            margin-top: 15px;
            margin-bottom: 10px;
        }

        .section p, .section ul {
            color: #444;
            line-height: 1.7;
            margin-bottom: 10px;
        }

        .section ul {
            margin-left: 20px;
        }

        .badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            margin-right: 8px;
            margin-bottom: 8px;
            background: #667eea;
            color: white;
        }

        .subclass-list, .subrace-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .subclass-card, .subrace-card {
            background: #f0f4ff;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            cursor: pointer;
            transition: all 0.3s;
        }

        .subclass-card:hover, .subrace-card:hover {
            background: #e0e8ff;
            transform: translateX(5px);
        }

        .subclass-card h5, .subrace-card h5 {
            color: #1e3c72;
            margin-bottom: 8px;
        }

        .feature-level {
            background: #f9f9f9;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            border-left: 4px solid #764ba2;
        }

        .feature-level h5 {
            color: #764ba2;
            margin-bottom: 10px;
        }

        .spell-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
        }

        .spell-card {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .spell-card:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .spell-level {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .spell-level-0 { background: #95a5a6; color: white; }
        .spell-level-1 { background: #3498db; color: white; }
        .spell-level-2 { background: #2ecc71; color: white; }
        .spell-level-3 { background: #f39c12; color: white; }
        .spell-level-4 { background: #e74c3c; color: white; }
        .spell-level-5 { background: #9b59b6; color: white; }
        .spell-level-6 { background: #1abc9c; color: white; }
        .spell-level-7 { background: #34495e; color: white; }
        .spell-level-8 { background: #c0392b; color: white; }
        .spell-level-9 { background: #8e44ad; color: white; }

        .search-box {
            width: 100%;
            padding: 15px;
            font-size: 1.1em;
            border: 2px solid #ddd;
            border-radius: 10px;
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        .search-box:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 10px rgba(102,126,234,0.3);
        }

        .filter-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .filter-btn {
            padding: 10px 20px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .filter-btn:hover {
            background: #667eea;
            color: white;
        }

        .filter-btn.active {
            background: #667eea;
            color: white;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-box .number {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-box .label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.2em;
            color: #666;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .grid {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                margin: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üêâ D&D 5E ÂÆåÊï¥Ë≥áÊñôÂ∫´</h1>
            <p>ÁπÅÈ´î‰∏≠Êñá | Á®ÆÊóè„ÄÅËÅ∑Ê•≠„ÄÅÊ≥ïË°ìÂÆåÊï¥Ë≥áÊñô</p>
        </div>

        <div class="tabs">
            <div class="tab active" data-tab="races">Á®ÆÊóè Races</div>
            <div class="tab" data-tab="classes">ËÅ∑Ê•≠ Classes</div>
            <div class="tab" data-tab="spells">Ê≥ïË°ì Spells</div>
        </div>

        <div class="content">
            <!-- Races Tab -->
            <div class="tab-content active" id="races">
                <input type="text" class="search-box" id="raceSearch" placeholder="üîç ÊêúÂ∞ãÁ®ÆÊóè...">
                <div class="stats-grid" id="raceStats"></div>
                <div class="grid" id="racesGrid"></div>
            </div>

            <!-- Classes Tab -->
            <div class="tab-content" id="classes">
                <input type="text" class="search-box" id="classSearch" placeholder="üîç ÊêúÂ∞ãËÅ∑Ê•≠...">
                <div class="stats-grid" id="classStats"></div>
                <div class="grid" id="classesGrid"></div>
            </div>

            <!-- Spells Tab -->
            <div class="tab-content" id="spells">
                <input type="text" class="search-box" id="spellSearch" placeholder="üîç ÊêúÂ∞ãÊ≥ïË°ì...">
                <div class="filter-buttons" id="spellFilters"></div>
                <div class="stats-grid" id="spellStats"></div>
                <div class="spell-grid" id="spellsGrid"></div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close-btn" onclick="closeModal()">&times;</span>
                <h2 id="modalTitle"></h2>
                <div class="subtitle" id="modalSubtitle"></div>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

    <script>
        // Global data storage
        let racesData = {};
        let classesData = {};
        let spellsData = {};

        // Load all data
        async function loadData() {
            try {
                const [races, classes, spells] = await Promise.all([
                    fetch('data/dnd5e_races_complete_tc.json').then(r => r.json()),
                    fetch('data/dnd5e_classes_complete_tc.json').then(r => r.json()),
                    fetch('data/dnd5e_spells_complete_tc.json').then(r => r.json())
                ]);

                racesData = races;
                classesData = classes;
                spellsData = spells;

                renderRaces();
                renderClasses();
                renderSpells();
                setupEventListeners();
            } catch (error) {
                console.error('Error loading data:', error);
                document.querySelector('.content').innerHTML = '<div class="loading">‚ùå ËºâÂÖ•Ë≥áÊñôÊôÇÁôºÁîüÈåØË™§</div>';
            }
        }

        // Render Races
        function renderRaces(searchTerm = '') {
            const grid = document.getElementById('racesGrid');
            const stats = document.getElementById('raceStats');
            
            const races = Object.entries(racesData).filter(([key, race]) =>
                searchTerm === '' || 
                race.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                race.name_en.toLowerCase().includes(searchTerm.toLowerCase())
            );

            // Stats
            const totalSubraces = races.reduce((sum, [, race]) => sum + Object.keys(race.subraces || {}).length, 0);
            stats.innerHTML = `
                <div class="stat-box">
                    <div class="number">${races.length}</div>
                    <div class="label">Á®ÆÊóè</div>
                </div>
                <div class="stat-box">
                    <div class="number">${totalSubraces}</div>
                    <div class="label">Â≠êÁ®ÆÊóè</div>
                </div>
            `;

            grid.innerHTML = races.map(([key, race]) => `
                <div class="card" onclick="showRaceDetail('${key}')">
                    <h3>${race.name}</h3>
                    <div class="subtitle">${race.name_en}</div>
                    <div class="description">${race.description.substring(0, 150)}...</div>
                    <div style="margin-top: 10px;">
                        <span class="badge">ÈÄüÂ∫¶: ${race.speed}</span>
                        <span class="badge">${Object.keys(race.subraces || {}).length} Â≠êÁ®ÆÊóè</span>
                    </div>
                </div>
            `).join('');
        }

        // Render Classes
        function renderClasses(searchTerm = '') {
            const grid = document.getElementById('classesGrid');
            const stats = document.getElementById('classStats');
            
            const classes = Object.entries(classesData).filter(([key, cls]) =>
                searchTerm === '' || 
                cls.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                cls.name_en.toLowerCase().includes(searchTerm.toLowerCase())
            );

            // Stats
            const totalSubclasses = classes.reduce((sum, [, cls]) => sum + Object.keys(cls.subclasses || {}).length, 0);
            const totalFeatures = classes.reduce((sum, [, cls]) => {
                return sum + Object.values(cls.features || {}).reduce((s, f) => s + f.length, 0);
            }, 0);

            stats.innerHTML = `
                <div class="stat-box">
                    <div class="number">${classes.length}</div>
                    <div class="label">ËÅ∑Ê•≠</div>
                </div>
                <div class="stat-box">
                    <div class="number">${totalSubclasses}</div>
                    <div class="label">Â≠êËÅ∑Ê•≠</div>
                </div>
                <div class="stat-box">
                    <div class="number">${totalFeatures}</div>
                    <div class="label">ËÅ∑Ê•≠ÁâπÊÄß</div>
                </div>
            `;

            grid.innerHTML = classes.map(([key, cls]) => `
                <div class="card" onclick="showClassDetail('${key}')">
                    <h3>${cls.name}</h3>
                    <div class="subtitle">${cls.name_en}</div>
                    <div class="description">${cls.description.substring(0, 150)}...</div>
                    <div style="margin-top: 10px;">
                        <span class="badge">ÁîüÂëΩÈ™∞: d${cls.hit_die}</span>
                        <span class="badge">${Object.keys(cls.subclasses || {}).length} Â≠êËÅ∑Ê•≠</span>
                    </div>
                </div>
            `).join('');
        }

        // Render Spells
        function renderSpells(searchTerm = '', levelFilter = null) {
            const grid = document.getElementById('spellsGrid');
            const stats = document.getElementById('spellStats');
            const filters = document.getElementById('spellFilters');
            
            // Setup level filters
            if (!filters.innerHTML) {
                filters.innerHTML = `
                    <button class="filter-btn active" data-level="all">ÂÖ®ÈÉ®</button>
                    <button class="filter-btn" data-level="0">Êà≤Ê≥ï</button>
                    ${[1,2,3,4,5,6,7,8,9].map(l => 
                        `<button class="filter-btn" data-level="${l}">${l}Áí∞</button>`
                    ).join('')}
                `;
                
                filters.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        filters.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        const level = btn.dataset.level === 'all' ? null : parseInt(btn.dataset.level);
                        renderSpells(document.getElementById('spellSearch').value, level);
                    });
                });
            }

            const spells = Object.entries(spellsData).filter(([key, spell]) => {
                const matchesSearch = searchTerm === '' || 
                    spell.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    spell.name_en.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    (spell.classes || []).some(c => c.toLowerCase().includes(searchTerm.toLowerCase()));
                
                const matchesLevel = levelFilter === null || spell.level === levelFilter;
                
                return matchesSearch && matchesLevel;
            });

            // Stats by level
            const levelCounts = {};
            Object.values(spellsData).forEach(spell => {
                levelCounts[spell.level] = (levelCounts[spell.level] || 0) + 1;
            });

            stats.innerHTML = `
                <div class="stat-box">
                    <div class="number">${Object.keys(spellsData).length}</div>
                    <div class="label">Á∏ΩÊ≥ïË°ìÊï∏</div>
                </div>
                <div class="stat-box">
                    <div class="number">${levelCounts[0] || 0}</div>
                    <div class="label">Êà≤Ê≥ï</div>
                </div>
                <div class="stat-box">
                    <div class="number">${Object.entries(levelCounts).filter(([l]) => l > 0).reduce((s, [,c]) => s + c, 0)}</div>
                    <div class="label">Áí∞Á¥öÊ≥ïË°ì</div>
                </div>
            `;

            grid.innerHTML = spells.map(([key, spell]) => `
                <div class="spell-card" onclick="showSpellDetail('${key}')">
                    <div class="spell-level spell-level-${spell.level}">
                        ${spell.level === 0 ? 'Êà≤Ê≥ï' : spell.level + 'Áí∞'}
                    </div>
                    <h3 style="color: #1e3c72; margin: 8px 0;">${spell.name}</h3>
                    <div style="color: #666; font-size: 0.9em; margin-bottom: 8px;">
                        ${spell.school} | ${spell.casting_time}
                    </div>
                    <div style="color: #444; font-size: 0.85em;">
                        ${(spell.classes || []).slice(0, 3).join(', ')}
                    </div>
                </div>
            `).join('');
        }

        // Show Race Detail
        function showRaceDetail(raceKey) {
            const race = racesData[raceKey];
            const modal = document.getElementById('modal');
            
            document.getElementById('modalTitle').textContent = race.name;
            document.getElementById('modalSubtitle').textContent = race.name_en;
            
            let bodyHTML = `
                <div class="section">
                    <h3>Âü∫Êú¨Ë≥áË®ä</h3>
                    <p><strong>ÈÄüÂ∫¶:</strong> ${race.speed}</p>
                    <p><strong>È´îÂûã:</strong> ${race.size}</p>
                    <p><strong>Ë™ûË®Ä:</strong> ${race.languages}</p>
                    ${race.age ? `<p><strong>Âπ¥ÈΩ°:</strong> ${race.age}</p>` : ''}
                    <p>${race.description}</p>
                </div>
            `;

            // Ability Bonuses
            if (race.ability_bonuses && Object.keys(race.ability_bonuses).length > 0) {
                bodyHTML += '<div class="section"><h3>Â±¨ÊÄßÂä†ÂÄº</h3><p>';
                Object.entries(race.ability_bonuses).forEach(([ability, bonus]) => {
                    bodyHTML += `<strong>${ability}:</strong> +${bonus} `;
                });
                bodyHTML += '</p></div>';
            }

            // Traits - Handle both object and array formats
            if (race.traits) {
                bodyHTML += '<div class="section"><h3>Á®ÆÊóèÁâπË≥™</h3>';
                
                // Handle both object and array formats
                const traitsArray = Array.isArray(race.traits) ? race.traits : Object.values(race.traits);
                
                traitsArray.forEach(trait => {
                    if (trait && trait.name) {
                        bodyHTML += `
                            <h4>${trait.name}</h4>
                            <p>${trait.description || 'Ê≠§ÁâπË≥™ÁöÑË©≥Á¥∞Ë™™Êòé'}</p>
                        `;
                    }
                });
                bodyHTML += '</div>';
            }

            // Subraces
            if (race.subraces && Object.keys(race.subraces).length > 0) {
                bodyHTML += '<div class="section"><h3>Â≠êÁ®ÆÊóè</h3><div class="subrace-list">';
                Object.entries(race.subraces).forEach(([key, subrace]) => {
                    if (subrace && subrace.name) {
                        const desc = subrace.description || '';
                        bodyHTML += `
                            <div class="subrace-card">
                                <h5>${subrace.name}</h5>
                                <p style="font-size: 0.9em; color: #666;">${desc.substring(0, 100)}${desc.length > 100 ? '...' : ''}</p>
                            </div>
                        `;
                    }
                });
                bodyHTML += '</div></div>';
            }

            document.getElementById('modalBody').innerHTML = bodyHTML;
            modal.classList.add('active');
        }

        // Show Class Detail
        function showClassDetail(classKey) {
            const cls = classesData[classKey];
            const modal = document.getElementById('modal');
            
            document.getElementById('modalTitle').textContent = cls.name;
            document.getElementById('modalSubtitle').textContent = cls.name_en;
            
            let bodyHTML = `
                <div class="section">
                    <h3>Âü∫Êú¨Ë≥áË®ä</h3>
                    <p>${cls.description}</p>
                    <p><strong>ÁîüÂëΩÈ™∞:</strong> d${cls.hit_die}</p>
                    <p><strong>Ë±ÅÂÖçÁÜüÁ∑¥:</strong> ${cls.saves.join(', ')}</p>
                    ${cls.proficiencies ? `
                        <p><strong>Ë≠∑Áî≤ÁÜüÁ∑¥:</strong> ${(cls.proficiencies.armor || []).join(', ') || 'ÁÑ°'}</p>
                        <p><strong>Ê≠¶Âô®ÁÜüÁ∑¥:</strong> ${(cls.proficiencies.weapons || []).join(', ') || 'ÁÑ°'}</p>
                    ` : ''}
                </div>
            `;

            // Features by level
            if (cls.features && Object.keys(cls.features).length > 0) {
                bodyHTML += '<div class="section"><h3>ËÅ∑Ê•≠ÁâπÊÄß</h3>';
                const sortedLevels = Object.keys(cls.features).sort((a, b) => parseInt(a) - parseInt(b));
                sortedLevels.forEach(level => {
                    const features = cls.features[level];
                    if (features && features.length > 0) {
                        bodyHTML += `<div class="feature-level">
                            <h5>Á¨¨ ${level} Á¥ö</h5>`;
                        features.forEach(feature => {
                            bodyHTML += `
                                <h4>${feature.name}</h4>
                                <p>${feature.description || 'Áç≤ÂæóÊ≠§ÁâπÊÄß'}</p>
                            `;
                        });
                        bodyHTML += '</div>';
                    }
                });
                bodyHTML += '</div>';
            }

            // Subclasses
            if (cls.subclasses && Object.keys(cls.subclasses).length > 0) {
                bodyHTML += '<div class="section"><h3>Â≠êËÅ∑Ê•≠</h3><div class="subclass-list">';
                Object.entries(cls.subclasses).forEach(([key, subclass]) => {
                    bodyHTML += `
                        <div class="subclass-card">
                            <h5>${subclass.name}</h5>
                            <p style="font-size: 0.9em; color: #666;">${subclass.description.substring(0, 120)}...</p>
                        </div>
                    `;
                });
                bodyHTML += '</div></div>';
            }

            document.getElementById('modalBody').innerHTML = bodyHTML;
            modal.classList.add('active');
        }

        // Show Spell Detail
        function showSpellDetail(spellKey) {
            const spell = spellsData[spellKey];
            const modal = document.getElementById('modal');
            
            document.getElementById('modalTitle').textContent = spell.name;
            document.getElementById('modalSubtitle').textContent = `${spell.level === 0 ? 'Êà≤Ê≥ï' : spell.level + 'Áí∞'} ${spell.school}`;
            
            let bodyHTML = `
                <div class="section">
                    <h3>Âü∫Êú¨Ë≥áË®ä</h3>
                    <p><strong>ÊñΩÊ≥ïÊôÇÈñì:</strong> ${spell.casting_time}</p>
                    <p><strong>Â∞ÑÁ®ã:</strong> ${spell.range}</p>
                    <p><strong>ÊàêÂàÜ:</strong> ${spell.components}</p>
                    <p><strong>ÊåÅÁ∫åÊôÇÈñì:</strong> ${spell.duration}</p>
                    <p><strong>ËÅ∑Ê•≠:</strong> ${(spell.classes || []).join(', ')}</p>
                </div>
                <div class="section">
                    <h3>ÊèèËø∞</h3>
                    <p>${spell.description}</p>
                </div>
            `;

            if (spell.upcast) {
                bodyHTML += `
                    <div class="section">
                        <h3>È´òÁí∞ÊñΩÊîæ</h3>
                        <p>${spell.upcast}</p>
                    </div>
                `;
            }

            document.getElementById('modalBody').innerHTML = bodyHTML;
            modal.classList.add('active');
        }

        // Close Modal
        function closeModal() {
            document.getElementById('modal').classList.remove('active');
        }

        // Setup Event Listeners
        function setupEventListeners() {
            // Tab switching
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    tab.classList.add('active');
                    document.getElementById(tab.dataset.tab).classList.add('active');
                });
            });

            // Search boxes
            document.getElementById('raceSearch').addEventListener('input', (e) => {
                renderRaces(e.target.value);
            });

            document.getElementById('classSearch').addEventListener('input', (e) => {
                renderClasses(e.target.value);
            });

            document.getElementById('spellSearch').addEventListener('input', (e) => {
                const activeFilter = document.querySelector('#spellFilters .filter-btn.active');
                const level = activeFilter && activeFilter.dataset.level !== 'all' ? parseInt(activeFilter.dataset.level) : null;
                renderSpells(e.target.value, level);
            });

            // Close modal on background click
            document.getElementById('modal').addEventListener('click', (e) => {
                if (e.target.id === 'modal') closeModal();
            });

            // Close modal on Escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') closeModal();
            });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', loadData);
    </script>
</body>
</html>
